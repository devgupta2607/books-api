language: node_js
node_js:
- lts/*
cache:
  directories:
  - node_modules
install:
- npm install
services:
- postgresql
env:
  global:
  - NODE_ENV=test
  - secure: nhqiuLYxjcp5DHALlrvShsdcylTmTVhPwRpj4i76yg5YOTtltOQEz34rQwCi4arGoUexWts7FPug/3kv6fpgH5ZsfN8BiVIVzvsyJ3oirs7UE7qeaP0ks4wYD/NCAWAYVOQVPOs9ApKn81t/c0zRiPfshzTZAEgFFUbCNMv8mOW/rLQttHR7TbqxqP28DJ5+FSov9t8El5fmj13ng7e/Ym1UVnU0Psh5AUtbwex5fqZFztqRa92f7mkfdswuvxpd3bIcWi/i3IkvaGF9UPTGgCer+5QrL2xxoeIMlV+6CaK30wrmnIdkcEBYEMnZRegcOQBC2v1L9K+oNQFQCCRhAIO5XrdEUlD+BvOV8kUOoV/JGfhV8TMcxLdw3ptKIcvMWfYbh+tvp5sXBlejBvT4lbY9I/GIAXOgrjq8lV9n+IymFUcmyQUisrsEqSnlLb/cA2EmQwEl6oaONyIDeUOHuV/j9uuFsj3P20ZfCvdwKzOfQsaXdXR7acxjoiOaT2sI5y/SZiAhM+5vYqGYtxBlnS8fjGZTbsmATKmXJZyJlN2XZYjO1Ym/hkWRi9JmYPuMdBTj5DsNKp7u8Q1+3eL0RjBBXgumAIXAJK7c+1lfV1PuDPnHN2qWv900NP8wRfuJ/5FCFS1AUotpKnc7rn5cgmcR6T1MwZxiaCdZdQ2rRDo=
before_script:
- psql -c 'create database book_test;' -U postgres
- npm run build
- npm install -g sequelize-cli
- sequelize db:migrate
script:
- npm test
after_success:
- npm run coverage
before_deploy:
- npm install now --no-save
- now rm books-api --token $NOW_TOKEN --yes || true
deploy:
- provider: script
  script: now --public --token $NOW_TOKEN
  skip_cleanup: true
  on:
    master: true
